<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>DailyMood ğŸ˜Š</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body class="bg-slate-100 text-slate-800 min-h-screen">

<!-- ================= NAVBAR ================= -->
<nav class="bg-blue-600 text-white shadow-lg"
     role="navigation"
     aria-label="Main navigation">

    <div class="max-w-7xl mx-auto px-4">
        <div class="flex items-center justify-between h-16">

            <a href="/"
               class="text-xl font-bold focus:outline-none focus:ring-2 focus:ring-white rounded">
                ğŸ§  DailyMood
            </a>

            <ul class="flex gap-6 items-center">
                <li th:each="item : ${navItems}">
                    <a th:href="@{${item.url}}"
                       th:text="${item.label}"
                       class="font-medium hover:underline focus:outline-none focus:ring-2 focus:ring-white rounded px-1">
                    </a>
                </li>
            </ul>

        </div>
    </div>
</nav>
<!-- ================= END NAVBAR ================= -->


<!-- ================= MAIN ================= -->
<main class="max-w-3xl mx-auto mt-10 bg-white rounded-2xl shadow-lg p-8">

    <!-- Back -->
    <a th:href="@{/daily_status}"
       class="inline-flex items-center gap-2 text-sm text-slate-600 hover:text-slate-900 mb-6
              focus:outline-none focus:ring-2 focus:ring-blue-400 rounded">
        â¬…ï¸ Back to Daily Status list
    </a>

    <!-- Title -->
    <h1 class="text-3xl font-bold mb-8">
        <span th:text="${dailyStatus.id} != null ? 'âœï¸ Edit Daily Status' : 'ğŸ“ Register Daily Status'"></span>
    </h1>

    <!-- ================= FORM ================= -->
    <form th:action="@{/daily_status/save}"
          th:object="${dailyStatus}"
          method="post"
          class="space-y-8">

        <input type="hidden" th:field="*{id}" />

        <!-- Date -->
        <div>
            <label for="date" class="block font-medium mb-1">
                ğŸ“… Date
            </label>
            <input type="date"
                   id="date"
                   th:field="*{date}"
                   required
                   class="w-full rounded-xl border border-slate-300 px-4 py-2
                          focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Observations -->
        <div>
            <label for="observations" class="block font-medium mb-1">
                ğŸ—’ï¸ Observations
            </label>
            <input type="text"
                   id="observations"
                   th:field="*{observations}"
                   placeholder="Describe how the resident feels today"
                   required
                   class="w-full rounded-xl border border-slate-300 px-4 py-2
                          focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- ================= STATUS SELECTOR ================= -->
        <div>
            <p class="font-medium mb-4" id="mood-label">
                ğŸŒˆ How is the resident today?
            </p>

            <!-- Hidden field for Spring -->
            <input type="hidden"
                   th:field="*{statusType}"
                   id="statusType"/>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4"
                 role="radiogroup"
                 aria-labelledby="mood-label">

                <!-- HAPPY -->
                <button type="button"
                        class="status-card"
                        data-value="HAPPY"
                        role="radio"
                        tabindex="0"
                        aria-checked="false">
                    <span class="text-6xl">ğŸ˜„</span>
                    <span class="mt-2 font-semibold text-lg">Happy</span>
                    <span class="text-sm text-slate-600 text-center">
                        Smiling, calm, positive mood
                    </span>
                </button>

                <!-- NEUTRAL -->
                <button type="button"
                        class="status-card"
                        data-value="NEUTRAL"
                        role="radio"
                        tabindex="0"
                        aria-checked="false">
                    <span class="text-6xl">ğŸ˜</span>
                    <span class="mt-2 font-semibold text-lg">Neutral</span>
                    <span class="text-sm text-slate-600 text-center">
                        Stable, no major changes
                    </span>
                </button>

                <!-- SAD -->
                <button type="button"
                        class="status-card"
                        data-value="SAD"
                        role="radio"
                        tabindex="0"
                        aria-checked="false">
                    <span class="text-6xl">ğŸ˜¢</span>
                    <span class="mt-2 font-semibold text-lg">Sad</span>
                    <span class="text-sm text-slate-600 text-center">
                        Low mood or discomfort
                    </span>
                </button>

            </div>
        </div>

        <!-- ================= RESIDENT ================= -->
        <div>
            <label class="block font-medium mb-2">
                ğŸ§‘â€âš•ï¸ Select Resident
            </label>

            <input type="text"
                   id="residentSearch"
                   placeholder="ğŸ” Search resident by name"
                   class="w-full mb-2 rounded-xl border border-slate-300 px-4 py-2
                          focus:outline-none focus:ring-2 focus:ring-blue-500">

            <select th:field="*{resident}"
                    size="5"
                    class="w-full rounded-xl border border-slate-300 px-4 py-2
                           focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option th:each="resident : ${residents}"
                        th:value="${resident.id}"
                        th:text="${resident.name}">
                </option>
            </select>
        </div>

        <!-- Submit -->
        <div class="pt-6">
            <button type="submit"
                    class="w-full bg-blue-600 hover:bg-blue-700
                           text-white font-semibold py-3 rounded-xl
                           transition focus:outline-none focus:ring-2 focus:ring-blue-400">
                <span th:text="${dailyStatus.id} != null ? 'âœ… Update Daily Status' : 'ğŸš€ Create Daily Status'"></span>
            </button>
        </div>

    </form>
</main>
<!-- ================= END MAIN ================= -->


<!-- ================= STYLES ================= -->
<style>
    .status-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius: 1rem;
        border: 2px solid #cbd5e1;
        padding: 1.25rem;
        background: white;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .status-card:hover {
        background: #f8fafc;
    }

    .status-card.active {
        border-color: #2563eb;
        background: #dbeafe;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.4);
    }
</style>

<!-- ================= SCRIPTS ================= -->
<script>
    document.addEventListener('DOMContentLoaded', () => {

        // Resident search
        const search = document.getElementById('residentSearch');
        search.addEventListener('input', function () {
            const filter = this.value.toLowerCase();
            const select = this.nextElementSibling;
            Array.from(select.options).forEach(option => {
                option.style.display = option.text.toLowerCase().includes(filter) ? '' : 'none';
            });
        });

        // Status selector logic
        const cards = document.querySelectorAll('.status-card');
        const input = document.getElementById('statusType');

        function activate(card) {
            cards.forEach(c => {
                c.classList.remove('active');
                c.setAttribute('aria-checked', 'false');
            });
            card.classList.add('active');
            card.setAttribute('aria-checked', 'true');
            input.value = card.dataset.value;
        }

        cards.forEach(card => {
            card.addEventListener('click', () => activate(card));
            card.addEventListener('keydown', e => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    activate(card);
                }
            });
        });

        // Preselect when editing
        if (input.value) {
            const selected = [...cards].find(c => c.dataset.value === input.value);
            if (selected) activate(selected);
        }
    });
</script>

</body>
</html>
