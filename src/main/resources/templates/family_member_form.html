<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Family Member Form</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 text-slate-800 min-h-screen">

<!-- Navbar -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<main class="max-w-5xl mx-auto px-4 py-6">


    <form th:action="@{/family_member/save}"
          th:object="${familyMember}"
          method="post"
          class="bg-white shadow-xl rounded-2xl p-6 space-y-6">
        <h2 class="text-2xl font-bold mb-6"
            th:text="${familyMember.id == null ? 'New Family Member' : 'Edit Family Member'}">
            Family Member Form
        </h2>

        <!-- Hidden fields -->
        <input type="hidden" th:field="*{id}"/>
        <input type="hidden" th:field="*{family.id}"/>

        <!-- Name / Surnames -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="name" class="block text-sm font-semibold mb-1">
                    Name
                </label>
                <input id="name"
                       type="text"
                       th:field="*{name}"
                       required
                       class="w-full rounded-lg border border-slate-300 px-3 py-2
                              focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>

            <div>
                <label for="surnames" class="block text-sm font-semibold mb-1">
                    Surnames
                </label>
                <input id="surnames"
                       type="text"
                       th:field="*{surnames}"
                       required
                       class="w-full rounded-lg border border-slate-300 px-3 py-2
                              focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>
        </div>

        <!-- Email / Phone -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="email" class="block text-sm font-semibold mb-1">
                    Email
                </label>
                <input id="email"
                       type="email"
                       th:field="*{email}"
                       class="w-full rounded-lg border border-slate-300 px-3 py-2
                              focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>

            <div>
                <label for="phone" class="block text-sm font-semibold mb-1">
                    Phone
                </label>
                <input id="phone"
                       type="text"
                       th:field="*{phoneNumber}"
                       class="w-full rounded-lg border border-slate-300 px-3 py-2
                              focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>
        </div>

        <!-- Birthdate / Notifications -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
            <div>
                <label for="birthDate" class="block text-sm font-semibold mb-1">
                    Birth Date
                </label>
                <input id="birthDate"
                       type="date"
                       th:field="*{birthDate}"
                       class="w-full rounded-lg border border-slate-300 px-3 py-2
                              focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>

            <div class="flex items-center gap-2 mt-6 md:mt-0">
                <input id="receiveNotifications"
                       type="checkbox"
                       th:field="*{receiveStatusNotifications}"
                       class="h-4 w-4 rounded border-slate-300
                              focus:ring-2 focus:ring-blue-400">
                <label for="receiveNotifications" class="text-sm font-medium">
                    Receive Notifications
                </label>
            </div>
        </div>

        <!-- Residents -->
        <hr class="border-slate-200">

        <h3 class="text-lg font-semibold">
            Residents
        </h3>

        <!-- Search -->
        <div class="flex gap-2">
            <input type="text"
                   id="keywordInput"
                   th:value="${keyword}"
                   placeholder="Search resident..."
                   class="flex-1 rounded-lg border border-slate-300 px-3 py-2
                          focus:outline-none focus:ring-2 focus:ring-blue-400">

            <button type="button"
                    onclick="searchResident()"
                    class="px-4 py-2 rounded-lg border border-slate-400
                           font-semibold hover:bg-slate-100
                           focus:outline-none focus:ring-2 focus:ring-slate-400">
                Search
            </button>
        </div>

        <!-- Residents list -->
        <div class="mt-4 border rounded-xl divide-y overflow-hidden">

            <label th:each="resident : ${residents}"
                   class="flex items-center gap-3 px-4 py-3 cursor-pointer
                          hover:bg-slate-50 transition">

                <input type="checkbox"
                       name="residentIds"
                       th:value="${resident.id}"
                       th:checked="${familyMember.family != null
                                    and familyMember.family.residents != null
                                    and familyMember.family.residents.contains(resident)}"
                       class="h-4 w-4 rounded border-slate-300
                              focus:ring-2 focus:ring-blue-400">

                <span th:text="${resident.name + ' ' + resident.surnames}"
                      class="text-sm font-medium">
                </span>
            </label>

            <div th:if="${#lists.isEmpty(residents)}"
                 class="px-4 py-6 text-center text-slate-500">
                No residents found.
            </div>

        </div>

        <!-- Actions -->
        <div class="flex gap-3 pt-4">
            <button type="submit"
                    class="px-6 py-2 rounded-xl bg-blue-600 text-white font-semibold
                           hover:bg-blue-700
                           focus:outline-none focus:ring-2 focus:ring-blue-400">
                Save
            </button>

            <a th:href="@{/family_member}"
               class="px-6 py-2 rounded-xl bg-slate-500 text-white font-semibold
                      hover:bg-slate-600
                      focus:outline-none focus:ring-2 focus:ring-slate-400">
                Cancel
            </a>
        </div>

    </form>
</main>

<script>
    function searchResident() {
        const keyword = document.getElementById('keywordInput').value;
        window.location.href = '/family_member/form?keyword=' + encodeURIComponent(keyword);
    }

    document.getElementById('keywordInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            searchResident();
        }
    });
</script>

</body>
</html>
